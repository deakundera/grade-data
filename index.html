<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모클 성적 조회 시스템</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .container {
            background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px; max-width: 1200px; margin: 0 auto;
        }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #333; font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: #666; font-size: 1.1em; }
        .tab-container { display: flex; margin-bottom: 30px; border-bottom: 2px solid #eee; }
        .tab {
            padding: 15px 30px; cursor: pointer; border: none; background: none;
            font-size: 1.1em; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;
        }
        .tab.active { color: #667eea; border-bottom-color: #667eea; font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .instructions {
            background: #e8f2ff; border-radius: 15px; padding: 25px; margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }
        .instructions h3 { color: #333; margin-bottom: 15px; font-size: 1.3em; }
        .instructions p { color: #666; line-height: 1.6; margin-bottom: 10px; }
        .search-section { margin-bottom: 30px; }
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-input {
            flex: 1; padding: 15px; border: 2px solid #ddd; border-radius: 10px;
            font-size: 1.1em; transition: border-color 0.3s;
        }
        .search-input:focus { outline: none; border-color: #667eea; }
        .search-btn {
            padding: 15px 30px; background: linear-gradient(45deg, #667eea, #764ba2);
            color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1.1em;
        }
        .search-btn:disabled { background: #ccc; cursor: not-allowed; }
        .student-info {
            background: #e8f2ff; border-radius: 15px; padding: 25px; margin: 25px 0;
            border-left: 5px solid #667eea;
        }
        .student-info h2 { color: #333; margin-bottom: 15px; font-size: 1.6em; }
        .summary-table {
            background: white; border-radius: 15px; padding: 25px; margin: 25px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); border-left: 5px solid #667eea; overflow-x: auto;
        }
        .summary-table h3 { color: #333; margin-bottom: 20px; font-size: 1.4em; }
        .grade-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        .grade-table th {
            background: #f8f9fa; color: #333; font-weight: bold; padding: 12px 8px;
            text-align: center; border: 1px solid #dee2e6;
        }
        .grade-table td { padding: 10px 8px; text-align: center; border: 1px solid #dee2e6; }
        .grade-table tr:nth-child(even) { background: #f8f9fa; }
        .test-name { font-weight: bold; color: #667eea; text-align: left !important; min-width: 80px; }
        .grade-cell { font-weight: bold; font-size: 1.1em; }
        .score-cell { font-weight: bold; color: #333; }
        .absent-cell { color: #999; font-style: italic; }
        .source-cell { font-size: 0.8em; color: #666; }
        .grade-1 { color: #e74c3c; } .grade-2 { color: #f39c12; } .grade-3 { color: #f1c40f; }
        .grade-4 { color: #2ecc71; } .grade-5 { color: #3498db; } .grade-6 { color: #9b59b6; }
        .analysis-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
            border-radius: 15px; padding: 30px; margin: 30px 0; box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .analysis-section h3 {
            color: white; margin-bottom: 25px; font-size: 1.5em; text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .analysis-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px; margin-bottom: 25px;
        }
        .analysis-card {
            background: rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 20px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .analysis-card h4 {
            color: #fff; margin-bottom: 15px; font-size: 1.2em;
            display: flex; align-items: center; gap: 8px;
        }
        .analysis-list { list-style: none; padding: 0; margin: 0; }
        .analysis-list li {
            background: rgba(255, 255, 255, 0.1); margin: 8px 0; padding: 10px 15px;
            border-radius: 8px; border-left: 4px solid #fff; font-size: 0.95em; line-height: 1.4;
        }
        .analysis-summary {
            background: rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 25px;
            margin-top: 25px; border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .analysis-summary h4 {
            color: #fff; margin-bottom: 15px; font-size: 1.3em; text-align: center;
        }
        .prediction-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px; margin-top: 15px;
        }
        .prediction-item {
            background: rgba(255, 255, 255, 0.15); padding: 15px; border-radius: 8px;
            text-align: center; border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .prediction-value {
            font-size: 1.4em; font-weight: bold; color: #fff; margin-bottom: 5px;
        }
        .prediction-label { font-size: 0.9em; color: rgba(255, 255, 255, 0.8); }
        .trend-up { color: #4CAF50; } .trend-down { color: #f44336; }
        .trend-stable { color: #ff9800; } .trend-volatile { color: #9c27b0; }
        .no-results, .no-data {
            text-align: center; color: #666; font-size: 1.2em; margin-top: 40px;
            padding: 40px; background: #f8f9fa; border-radius: 15px;
        }
        @media (max-width: 768px) {
            .container { padding: 20px; }
            .search-box { flex-direction: column; }
            .grade-table { font-size: 0.8em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 모클 성적 조회 시스템</h1>
            <p>정동민국어논술학원 • 고2 모의고사 성적 조회</p>
        </div>
        
        <div class="tab-container">
            <button class="tab active" onclick="switchTab('student')">🔍 성적 조회</button>
        </div>
        
        <div id="studentTab" class="tab-content active">
            <div class="instructions">
                <h3>📋 성적 조회 방법</h3>
                <p>• <strong>출결번호로 검색:</strong> 본인의 4자리 출결번호를 입력하세요</p>
                <p>• 예시: 3188, 1234, 2274 등</p>
            </div>
            
            <div class="search-section">
                <div class="search-box">
                    <input type="text" id="searchInput" class="search-input" placeholder="출결번호를 입력하세요 (예: 3188)" maxlength="4">
                    <button onclick="searchStudent()" class="search-btn" id="searchBtn">🔍 조회</button>
                </div>
            </div>
            
            <div id="noData" class="no-data">
                <h3>📋 데이터 준비 중</h3>
                <p>성적 데이터를 준비하고 있습니다...</p>
            </div>
            
            <div id="results" style="display: none;">
                <div id="studentInfo"></div>
                <div id="summaryTable"></div>
            </div>
            
            <div id="noResults" class="no-results" style="display: none;">
                <h3>🔍 검색 결과가 없습니다</h3>
                <p>입력하신 출결번호를 다시 확인해주세요.</p>
            </div>
        </div>
    </div>

    <script>
        // 샘플 데이터 (실제로는 서버에서 가져올 데이터)
        var studentByNumber = {
            "3188": {
                name: "김재모",
                attendanceNumber: "3188",
                grades: {
                    "모클1회": {
                        grade: 3, score: 72, gradeCut: 75, needScore: 3, source: "2024년 3월 교육청",
                        details: {"화법과 작문": 18, "문법": 8, "독서(인문)": 8, "독서(사회)": 8, "독서(과학)": 12, "문학(현대시)": 4, "문학(현대소설)": 7, "문학(고전시가)": 4, "문학(고전소설)": 3},
                        ratios: {"화법과 작문": 82, "문법": 36, "독서(인문)": 33, "독서(사회)": 32, "독서(과학)": 46, "문학(현대시)": 50, "문학(현대소설)": 78, "문학(고전시가)": 100, "문학(고전소설)": 22}
                    },
                    "모클2회": {
                        grade: 2, score: 83, gradeCut: 78, needScore: -5, source: "2024년 6월 교육청",
                        details: {"화법과 작문": 22, "문법": 8, "독서(인문)": 12, "독서(사회)": 0, "독서(과학)": 12, "문학(현대시)": 4, "문학(현대소설)": 7, "문학(고전시가)": 8, "문학(고전소설)": 10},
                        ratios: {"화법과 작문": 100, "문법": 36, "독서(인문)": 52, "독서(사회)": 0, "독서(과학)": 46, "문학(현대시)": 50, "문학(현대소설)": 78, "문학(고전시가)": 100, "문학(고전소설)": 100}
                    },
                    "모클3회": {
                        grade: 3, score: 75, gradeCut: 72, needScore: -3, source: "2024년 9월 교육청",
                        details: {"화법과 작문": 20, "문법": 8, "독서(인문)": 8, "독서(사회)": 16, "독서(과학)": 8, "문학(현대시)": 4, "문학(현대소설)": 7, "문학(고전시가)": 4, "문학(고전소설)": 0},
                        ratios: {"화법과 작문": 91, "문법": 36, "독서(인문)": 33, "독서(사회)": 64, "독서(과학)": 31, "문학(현대시)": 50, "문학(현대소설)": 78, "문학(고전시가)": 100, "문학(고전소설)": 0}
                    },
                    "모클4회": {
                        grade: 2, score: 79, gradeCut: 81, needScore: 2, source: "2024년 11월 교육청",
                        details: {"화법과 작문": 13, "문법": 8, "독서(인문)": 12, "독서(사회)": 12, "독서(과학)": 8, "문학(현대시)": 4, "문학(현대소설)": 7, "문학(고전시가)": 8, "문학(고전소설)": 6},
                        ratios: {"화법과 작문": 100, "문법": 36, "독서(인문)": 52, "독서(사회)": 48, "독서(과학)": 31, "문학(현대시)": 50, "문학(현대소설)": 78, "문학(고전시가)": 100, "문학(고전소설)": 60}
                    },
                    "모클5회": {
                        grade: 4, score: 59, gradeCut: 65, needScore: 6, source: "2025년 사설 모의고사",
                        details: {"화법과 작문": 8, "문법": 8, "독서(인문)": 8, "독서(사회)": 12, "독서(과학)": 4, "문학(현대시)": 4, "문학(현대소설)": 7, "문학(고전시가)": 4, "문학(고전소설)": 4},
                        ratios: {"화법과 작문": 62, "문법": 36, "독서(인문)": 33, "독서(사회)": 48, "독서(과학)": 15, "문학(현대시)": 50, "문학(현대소설)": 78, "문학(고전시가)": 100, "문학(고전소설)": 40}
                    },
                    "모클6회": {
                        grade: 3, score: 68, gradeCut: 70, needScore: 2, source: "2025년 1월 사설",
                        details: {"화법과 작문": 18, "문법": 8, "독서(인문)": 8, "독서(사회)": 8, "독서(과학)": 8, "문학(현대시)": 4, "문학(현대소설)": 7, "문학(고전시가)": 4, "문학(고전소설)": 3},
                        ratios: {"화법과 작문": 82, "문법": 36, "독서(인문)": 33, "독서(사회)": 32, "독서(과학)": 31, "문학(현대시)": 50, "문학(현대소설)": 78, "문학(고전시가)": 100, "문학(고전소설)": 30}
                    },
                    "모클7회": {
                        grade: 2, score: 80, gradeCut: 77, needScore: -3, source: "2025년 2월 사설",
                        details: {"화법과 작문": 20, "문법": 8, "독서(인문)": 12, "독서(사회)": 12, "독서(과학)": 8, "문학(현대시)": 4, "문학(현대소설)": 7, "문학(고전시가)": 4, "문학(고전소설)": 5},
                        ratios: {"화법과 작문": 91, "문법": 36, "독서(인문)": 52, "독서(사회)": 48, "독서(과학)": 31, "문학(현대시)": 50, "문학(현대소설)": 78, "문학(고전시가)": 100, "문학(고전소설)": 50}
                    },
                    "모클8회": {
                        grade: 2, score: 78, gradeCut: 76, needScore: -2, source: "2025년 3월 사설",
                        details: {"화법과 작문": 22, "문법": 8, "독서(인문)": 12, "독서(사회)": 12, "독서(과학)": 4, "문학(현대시)": 4, "문학(현대소설)": 7, "문학(고전시가)": 4, "문학(고전소설)": 5},
                        ratios: {"화법과 작문": 100, "문법": 36, "독서(인문)": 52, "독서(사회)": 53, "독서(과학)": 31, "문학(현대시)": 50, "문학(현대소설)": 78, "문학(고전시가)": 100, "문학(고전소설)": 100}
                    }
                }
            },
            "1234": {
                name: "박지수",
                attendanceNumber: "1234",
                grades: {
                    "모클1회": {
                        grade: 1, score: 92, gradeCut: 88, needScore: -4, source: "2024년 3월 교육청",
                        details: {"화법과 작문": 22, "문법": 12, "독서(인문)": 16, "독서(사회)": 12, "독서(과학)": 12, "문학(현대시)": 8, "문학(현대소설)": 9, "문학(고전시가)": 4, "문학(고전소설)": 9},
                        ratios: {"화법과 작문": 100, "문법": 55, "독서(인문)": 67, "독서(사회)": 48, "독서(과학)": 46, "문학(현대시)": 100, "문학(현대소설)": 100, "문학(고전시가)": 100, "문학(고전소설)": 67}
                    },
                    "모클2회": {
                        grade: 1, score: 89, gradeCut: 85, needScore: -4, source: "2024년 6월 교육청",
                        details: {"화법과 작문": 22, "문법": 10, "독서(인문)": 16, "독서(사회)": 16, "독서(과학)": 8, "문학(현대시)": 6, "문학(현대소설)": 7, "문학(고전시가)": 4, "문학(고전소설)": 0},
                        ratios: {"화법과 작문": 100, "문법": 45, "독서(인문)": 67, "독서(사회)": 64, "독서(과학)": 31, "문학(현대시)": 75, "문학(현대소설)": 78, "문학(고전시가)": 100, "문학(고전소설)": 0}
                    }
                }
            }
        };

        var discoveredTestSheets = ["모클1회", "모클2회", "모클3회", "모클4회", "모클5회", "모클6회", "모클7회", "모클8회"];
        var isDataLoaded = true;

        function switchTab(tabName) {
            // 탭 전환 로직 (필요시 확장)
        }

        function searchStudent() {
            var query = document.getElementById('searchInput').value.trim();
            var resultsDiv = document.getElementById('results');
            var noResultsDiv = document.getElementById('noResults');
            var noDataDiv = document.getElementById('noData');
            
            resultsDiv.style.display = 'none';
            noResultsDiv.style.display = 'none';
            noDataDiv.style.display = 'none';
            
            if (!query) {
                alert('출결번호를 입력해주세요.');
                return;
            }
            
            var student = studentByNumber[query];
            
            if (!student) {
                noResultsDiv.style.display = 'block';
                return;
            }
            
            displayStudentInfo(student);
            displaySummaryTable(student);
            resultsDiv.style.display = 'block';
        }

        function displayStudentInfo(student) {
            var studentInfoDiv = document.getElementById('studentInfo');
            var gradeKeys = Object.keys(student.grades);
            var totalTests = discoveredTestSheets.length;
            var attendedTests = gradeKeys.length;
            
            studentInfoDiv.innerHTML = '<div class="student-info">' +
                '<h2>👨‍🎓 ' + student.name + '</h2>' +
                '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">' +
                '<div style="display: flex; justify-content: space-between;"><span style="font-weight: 600; color: #555;">출결번호:</span><span style="color: #333; font-weight: bold;">' + student.attendanceNumber + '</span></div>' +
                '<div style="display: flex; justify-content: space-between;"><span style="font-weight: 600; color: #555;">응시 현황:</span><span style="color: #333; font-weight: bold;">' + attendedTests + '/' + totalTests + '회</span></div>' +
                '</div></div>';
        }

        function displaySummaryTable(student) {
            var summaryTableDiv = document.getElementById('summaryTable');
            var allTests = discoveredTestSheets;
            var totalTests = allTests.length;
            
            var tableHtml = '';
            
            // 전체 성적 현황 표
            tableHtml += '<div class="summary-table">';
            tableHtml += '<h3>📊 전체 성적 현황 (' + totalTests + '개 시험)</h3>';
            tableHtml += '<table class="grade-table">';
            tableHtml += '<thead><tr>';
            tableHtml += '<th class="test-name">시험</th>';
            tableHtml += '<th>등급</th>';
            tableHtml += '<th>점수</th>';
            tableHtml += '<th>등급컷</th>';
            tableHtml += '<th>출처</th>';
            tableHtml += '</tr></thead><tbody>';
            
            for (var i = 0; i < allTests.length; i++) {
                var testName = allTests[i];
                var gradeData = student.grades[testName];
                
                tableHtml += '<tr>';
                tableHtml += '<td class="test-name">' + testName + '</td>';
                
                if (gradeData) {
                    tableHtml += '<td class="grade-cell grade-' + gradeData.grade + '">' + gradeData.grade + '</td>';
                    tableHtml += '<td class="score-cell">' + gradeData.score + '</td>';
                    tableHtml += '<td class="score-cell">' + (gradeData.gradeCut || '-') + '</td>';
                    tableHtml += '<td class="source-cell">' + (gradeData.source || '-') + '</td>';
                } else {
                    tableHtml += '<td class="absent-cell">미응시</td>';
                    tableHtml += '<td class="absent-cell">-</td>';
                    tableHtml += '<td class="absent-cell">-</td>';
                    tableHtml += '<td class="absent-cell">-</td>';
                }
                
                tableHtml += '</tr>';
            }
            
            tableHtml += '</tbody></table></div>';
            
            // 과목별 성취도 비율 현황 표
            tableHtml += '<div class="summary-table" style="margin-top: 30px;">';
            tableHtml += '<h3>📈 과목별 성취도 비율 현황</h3>';
            tableHtml += '<div style="overflow-x: auto;">';
            tableHtml += '<table class="grade-table" style="min-width: 1200px; font-size: 0.8em;">';
            tableHtml += '<thead><tr>';
            tableHtml += '<th style="min-width: 80px;">시험</th>';
            tableHtml += '<th style="min-width: 50px;">등급</th>';
            tableHtml += '<th style="min-width: 50px;">점수</th>';
            tableHtml += '<th style="min-width: 60px;">등급컷 필요점수</th>';
            tableHtml += '<th style="min-width: 80px;">화법과 작문</th>';
            tableHtml += '<th style="min-width: 60px;">문법</th>';
            tableHtml += '<th style="min-width: 80px;">독서(인문)</th>';
            tableHtml += '<th style="min-width: 80px;">독서(사회)</th>';
            tableHtml += '<th style="min-width: 80px;">독서(과학)</th>';
            tableHtml += '<th style="min-width: 80px;">문학(현대시)</th>';
            tableHtml += '<th style="min-width: 90px;">문학(현대소설)</th>';
            tableHtml += '<th style="min-width: 90px;">문학(고전시가)</th>';
            tableHtml += '<th style="min-width: 90px;">문학(고전소설)</th>';
            tableHtml += '<th style="min-width: 70px;">시험출처</th>';
            tableHtml += '</tr></thead><tbody>';
            
            for (var i = 0; i < allTests.length; i++) {
                var testName = allTests[i];
                var gradeData = student.grades[testName];
                
                tableHtml += '<tr>';
                tableHtml += '<td class="test-name">' + testName + '</td>';
                
                if (gradeData) {
                    tableHtml += '<td class="grade-cell grade-' + gradeData.grade + '">' + gradeData.grade + '</td>';
                    tableHtml += '<td class="score-cell">' + gradeData.score + '</td>';
                    
                    var needScoreDisplay = '';
                    if (gradeData.needScore !== null && gradeData.needScore !== undefined) {
                        needScoreDisplay = gradeData.needScore > 0 ? '(' + gradeData.needScore + ')' : '(' + gradeData.needScore + ')';
                    }
                    tableHtml += '<td class="score-cell">' + needScoreDisplay + '</td>';
                    
                    var subjectOrder = ['화법과 작문', '문법', '독서(인문)', '독서(사회)', '독서(과학)', 
                                       '문학(현대시)', '문학(현대소설)', '문학(고전시가)', '문학(고전소설)'];
                    
                    for (var j = 0; j < subjectOrder.length; j++) {
                        var targetSubject = subjectOrder[j];
                        var ratio = 0;
                        
                        for (var actualSubject in gradeData.ratios) {
                            if (actualSubject.indexOf(targetSubject.split('(')[0]) !== -1 || 
                                targetSubject.indexOf(actualSubject.split('(')[0]) !== -1) {
                                ratio = gradeData.ratios[actualSubject] || 0;
                                break;
                            }
                        }
                        
                        var ratioColor = ratio >= 90 ? '#e74c3c' : ratio >= 80 ? '#f39c12' : ratio >= 70 ? '#f1c40f' : 
                                        ratio >= 60 ? '#2ecc71' : ratio >= 50 ? '#3498db' : '#95a5a6';
                        var ratioText = ratio > 0 ? ratio + '%' : '-';
                        
                        tableHtml += '<td style="color: ' + ratioColor + '; font-weight: bold; text-align: center;">' + ratioText + '</td>';
                    }
                    
                    tableHtml += '<td class="source-cell">' + (gradeData.source || '-') + '</td>';
                } else {
                    tableHtml += '<td class="absent-cell">미응시</td>';
                    tableHtml += '<td class="absent-cell">-</td>';
                    tableHtml += '<td class="absent-cell">-</td>';
                    for (var k = 0; k < 9; k++) {
                        tableHtml += '<td class="absent-cell">-</td>';
                    }
                    tableHtml += '<td class="absent-cell">-</td>';
                }
                
                tableHtml += '</tr>';
            }
            
            tableHtml += '</tbody></table></div></div>';
            
            // AI 성적 분석 섹션 추가
            tableHtml += generateStudentAnalysis(student);
            
            summaryTableDiv.innerHTML = tableHtml;
        }

        function generateStudentAnalysis(student) {
            var grades = student.grades;
            var testNames = Object.keys(grades).sort();
            
            if (testNames.length < 2) {
                return '<div class="analysis-section"><h3>🤖 AI 성적 분석</h3><p style="text-align: center; opacity: 0.8;">분석을 위해서는 최소 2회 이상의 성적 데이터가 필요합니다.</p></div>';
            }
            
            var scores = [];
            var gradeNums = [];
            for (var i = 0; i < testNames.length; i++) {
                scores.push(grades[testNames[i]].score);
                gradeNums.push(parseInt(grades[testNames[i]].grade));
            }
            
            var maxScore = Math.max.apply(Math, scores);
            var minScore = Math.min.apply(Math, scores);
            var currentScore = scores[scores.length - 1];
            var currentGrade = gradeNums[gradeNums.length - 1];
            
            var subjectAverages = {};
            var subjectTrends = {};
            var subjectData = {};
            
            for (var i = 0; i < testNames.length; i++) {
                var testName = testNames[i];
                var testData = grades[testName];
                if (testData.ratios) {
                    var subjects = Object.keys(testData.ratios);
                    for (var j = 0; j < subjects.length; j++) {
                        var subject = subjects[j];
                        if (!subjectData[subject]) {
                            subjectData[subject] = [];
                        }
                        subjectData[subject].push(testData.ratios[subject]);
                    }
                }
            }
            
            var subjects = Object.keys(subjectData);
            for (var i = 0; i < subjects.length; i++) {
                var subject = subjects[i];
                var values = subjectData[subject];
                var sum = 0;
                for (var j = 0; j < values.length; j++) {
                    sum += values[j];
                }
                subjectAverages[subject] = sum / values.length;
                
                if (values.length >= 2) {
                    var firstValue = values[0];
                    var lastValue = values[values.length - 1];
                    var change = lastValue - firstValue;
                    var variance = Math.max.apply(Math, values) - Math.min.apply(Math, values);
                    
                    if (variance > 30) {
                        subjectTrends[subject] = {type: 'volatile', change: change, variance: variance};
                    } else if (change > 10) {
                        subjectTrends[subject] = {type: 'up', change: change, variance: variance};
                    } else if (change < -10) {
                        subjectTrends[subject] = {type: 'down', change: change, variance: variance};
                    } else {
                        subjectTrends[subject] = {type: 'stable', change: change, variance: variance};
                    }
                }
            }
            
            var sortedSubjects = subjects.sort(function(a, b) {
                return subjectAverages[b] - subjectAverages[a];
            });
            var strongSubjects = sortedSubjects.slice(0, 3);
            var weakSubjects = sortedSubjects.slice(-3).reverse();
            
            var targetScore = currentGrade > 1 ? Math.ceil((currentScore + 15) / 5) * 5 : 90;
            var neededPoints = Math.max(0, targetScore - currentScore);
            
            var analysisHtml = '<div class="analysis-section">';
            analysisHtml += '<h3>🤖 AI 성적 분석 리포트</h3>';
            
            analysisHtml += '<div class="analysis-grid">';
            
            // 현재 성적 현황
            analysisHtml += '<div class="analysis-card">';
            analysisHtml += '<h4>📊 현재 성적 현황</h4>';
            analysisHtml += '<ul class="analysis-list">';
            analysisHtml += '<li><strong>응시 현황:</strong> ' + testNames.length + '회 모의고사</li>';
            analysisHtml += '<li><strong>최고 성적:</strong> ' + Math.min.apply(Math, gradeNums) + '등급 ' + maxScore + '점</li>';
            analysisHtml += '<li><strong>최저 성적:</strong> ' + Math.max.apply(Math, gradeNums) + '등급 ' + minScore + '점</li>';
            analysisHtml += '<li><strong>현재 등급:</strong> ' + currentGrade + '등급 ' + currentScore + '점</li>';
            analysisHtml += '</ul></div>';
            
            // 강점 과목
            analysisHtml += '<div class="analysis-card">';
            analysisHtml += '<h4>💪 강점 과목 분석</h4>';
            analysisHtml += '<ul class="analysis-list">';
            for (var i = 0; i < Math.min(3, strongSubjects.length); i++) {
                var subject = strongSubjects[i];
                analysisHtml += '<li><strong>' + (i + 1) + '. ' + subject + ':</strong> 평균 ' + subjectAverages[subject].toFixed(1) + '%</li>';
            }
            analysisHtml += '</ul></div>';
            
            // 개선 필요 과목
            analysisHtml += '<div class="analysis-card">';
            analysisHtml += '<h4>📈 개선 필요 과목</h4>';
            analysisHtml += '<ul class="analysis-list">';
            for (var i = 0; i < Math.min(3, weakSubjects.length); i++) {
                var subject = weakSubjects[i];
                analysisHtml += '<li><strong>' + (i + 1) + '. ' + subject + ':</strong> 평균 ' + subjectAverages[subject].toFixed(1) + '%</li>';
            }
            analysisHtml += '</ul></div>';
            
            // 추세 분석
            analysisHtml += '<div class="analysis-card">';
            analysisHtml += '<h4>📈 비율 추이 분석</h4>';
            analysisHtml += '<ul class="analysis-list">';
            
            var trendGroups = {up: [], down: [], stable: [], volatile: []};
            var trendSubjects = Object.keys(subjectTrends);
            for (var i = 0; i < trendSubjects.length; i++) {
                var subject = trendSubjects[i];
                var trend = subjectTrends[subject];
                trendGroups[trend.type].push({
                    subject: subject,
                    change: trend.change,
                    variance: trend.variance
                });
            }
            
            if (trendGroups.up.length > 0) {
                var upList = [];
                for (var i = 0; i < trendGroups.up.length; i++) {
                    var item = trendGroups.up[i];
                    upList.push(item.subject + ' (+' + item.change.toFixed(0) + '%)');
                }
                analysisHtml += '<li class="trend-up"><strong>상승 추세:</strong> ' + upList.join(', ') + '</li>';
            }
            
            if (trendGroups.down.length > 0) {
                var downList = [];
                for (var i = 0; i < trendGroups.down.length; i++) {
                    var item = trendGroups.down[i];
                    downList.push(item.subject + ' (' + item.change.toFixed(0) + '%)');
                }
                analysisHtml += '<li class="trend-down"><strong>하락 추세:</strong> ' + downList.join(', ') + '</li>';
            }
            
            if (trendGroups.volatile.length > 0) {
                var volatileList = [];
                for (var i = 0; i < trendGroups.volatile.length; i++) {
                    var item = trendGroups.volatile[i];
                    volatileList.push(item.subject + ' (변동폭: ' + item.variance.toFixed(0) + '%)');
                }
                analysisHtml += '<li class="trend-volatile"><strong>변동성 큰 과목:</strong> ' + volatileList.join(', ') + '</li>';
            }
            
            if (trendGroups.stable.length > 0) {
                var stableList = [];
                for (var i = 0; i < trendGroups.stable.length; i++) {
                    stableList.push(trendGroups.stable[i].subject);
                }
                analysisHtml += '<li class="trend-stable"><strong>안정적 과목:</strong> ' + stableList.join(', ') + '</li>';
            }
            
            analysisHtml += '</ul></div>';
            
            // 성적 향상 전략
            analysisHtml += '<div class="analysis-card">';
            analysisHtml += '<h4>🎯 성적 향상 전략</h4>';
            analysisHtml += '<ul class="analysis-list">';
            
            var prioritySubjects = weakSubjects.slice(0, 2);
            if (trendGroups.down.length > 0) {
                prioritySubjects.push(trendGroups.down[0].subject);
                var uniquePriority = [];
                for (var i = 0; i < prioritySubjects.length; i++) {
                    if (uniquePriority.indexOf(prioritySubjects[i]) === -1) {
                        uniquePriority.push(prioritySubjects[i]);
                    }
                }
                prioritySubjects = uniquePriority;
            }
            
            analysisHtml += '<li><strong>우선순위 보완:</strong> ' + prioritySubjects.join(', ') + '</li>';
            
            if (strongSubjects.length > 0) {
                analysisHtml += '<li><strong>강점 유지:</strong> ' + strongSubjects[0] + ' 고득점 지속</li>';
            }
            
            if (trendGroups.volatile.length > 0) {
                analysisHtml += '<li><strong>안정화 필요:</strong> ' + trendGroups.volatile[0].subject + ' 변동성 감소</li>';
            }
            
            analysisHtml += '</ul></div>';
            analysisHtml += '</div>';
            
            // 등급 전망 및 목표
            analysisHtml += '<div class="analysis-summary">';
            analysisHtml += '<h4>🚀 등급 상승 전망 및 목표</h4>';
            analysisHtml += '<div class="prediction-grid">';
            
            if (currentGrade > 1) {
                analysisHtml += '<div class="prediction-item">';
                analysisHtml += '<div class="prediction-value">' + (currentGrade - 1) + '등급</div>';
                analysisHtml += '<div class="prediction-label">목표 등급</div>';
                analysisHtml += '</div>';
                
                analysisHtml += '<div class="prediction-item">';
                analysisHtml += '<div class="prediction-value">' + targetScore + '점</div>';
                analysisHtml += '<div class="prediction-label">목표 점수</div>';
                analysisHtml += '</div>';
                
                analysisHtml += '<div class="prediction-item">';
                analysisHtml += '<div class="prediction-value">+' + neededPoints + '점</div>';
                analysisHtml += '<div class="prediction-label">추가 필요</div>';
                analysisHtml += '</div>';
                
                var expectedTests = Math.ceil(neededPoints / 3) + 1;
                analysisHtml += '<div class="prediction-item">';
                analysisHtml += '<div class="prediction-value">' + expectedTests + '회 후</div>';
                analysisHtml += '<div class="prediction-label">예상 달성</div>';
                analysisHtml += '</div>';
            } else {
                analysisHtml += '<div class="prediction-item">';
                analysisHtml += '<div class="prediction-value">1등급 유지</div>';
                analysisHtml += '<div class="prediction-label">현재 목표</div>';
                analysisHtml += '</div>';
            }
            
            analysisHtml += '</div>';
            
            // 종합 분석
            var improvementPotential = '';
            if (trendGroups.up.length > trendGroups.down.length) {
                improvementPotential = '상승 동력을 보유하고 있어 꾸준한 성적 향상이 기대됩니다.';
            } else if (trendGroups.volatile.length > 0) {
                improvementPotential = '일부 과목의 안정화를 통해 성적 상승이 가능합니다.';
            } else {
                improvementPotential = '기본기 강화를 통한 점진적 향상이 필요합니다.';
            }
            
            var expectedTests = Math.ceil(neededPoints / 3) + 1;
            
            analysisHtml += '<p style="margin-top: 20px; text-align: center; font-size: 1.1em; line-height: 1.6; opacity: 0.9;">';
            analysisHtml += '<strong>🎓 종합 분석:</strong> ' + student.name + ' 학생은 ' + improvementPotential;
            if (strongSubjects.length > 0) {
                analysisHtml += ' ' + strongSubjects[0] + ' 영역의 강점을 활용하고';
            }
            if (weakSubjects.length > 0) {
                analysisHtml += ' ' + weakSubjects[0] + ' 영역을 집중 보완하면';
            }
            if (currentGrade > 1) {
                analysisHtml += ' ' + expectedTests + '회 내 ' + (currentGrade - 1) + '등급 달성이 충분히 가능합니다.';
            } else {
                analysisHtml += ' 지속적인 1등급 유지가 가능합니다.';
            }
            analysisHtml += '</p>';
            
            analysisHtml += '</div></div>';
            
            return analysisHtml;
        }

        // 이벤트 리스너 설정
        document.getElementById('searchInput').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
            if (e.target.value.length > 4) {
                e.target.value = e.target.value.slice(0, 4);
            }
        });

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStudent();
            }
        });

        // 페이지 로드 시 데이터 준비 완료 표시
        window.onload = function() {
            document.getElementById('noData').innerHTML = '<h3>✅ 성적 데이터 준비 완료</h3><p>출결번호를 입력하여 성적을 조회하세요.</p>';
        };
    </script>
</body>
</html>
